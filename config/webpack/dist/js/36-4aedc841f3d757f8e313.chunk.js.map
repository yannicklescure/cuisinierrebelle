{"version":3,"file":"js/36-4aedc841f3d757f8e313.chunk.js","sources":["webpack:///./app/javascript/vue/components/comments/Show.vue","webpack:///./app/javascript/vue/components/comments/Show.vue?e439","webpack:///./app/javascript/vue/components/comments/Show.vue?3777","webpack:///Show.vue","webpack:///./app/javascript/vue/components/comments/Show.vue?eb87"],"sourcesContent":["import { render, staticRenderFns } from \"./Show.vue?vue&type=template&id=45d040de&\"\nimport script from \"./Show.vue?vue&type=script&lang=js&\"\nexport * from \"./Show.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  null,\n  null\n  \n)\n\n/* hot reload */\nif (module.hot) {\n  var api = require(\"/home/torac/code/cuisinierrebelle/node_modules/vue-hot-reload-api/dist/index.js\")\n  api.install(require('vue'))\n  if (api.compatible) {\n    module.hot.accept()\n    if (!api.isRecorded('45d040de')) {\n      api.createRecord('45d040de', component.options)\n    } else {\n      api.reload('45d040de', component.options)\n    }\n    module.hot.accept(\"./Show.vue?vue&type=template&id=45d040de&\", function () {\n      api.rerender('45d040de', {\n        render: render,\n        staticRenderFns: staticRenderFns\n      })\n    })\n  }\n}\ncomponent.options.__file = \"app/javascript/vue/components/comments/Show.vue\"\nexport default component.exports","import mod from \"-!../../../../../node_modules/babel-loader/lib/index.js??ref--6-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Show.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../../../node_modules/babel-loader/lib/index.js??ref--6-0!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Show.vue?vue&type=script&lang=js&\"","export * from \"-!../../../../../node_modules/vue-loader/lib/loaders/templateLoader.js??vue-loader-options!../../../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./Show.vue?vue&type=template&id=45d040de&\"","<template>\n  <div :id=\"'comment' + item.id\" :ref=\"type + item.id\" class=\"mt-3 mb-2\">\n    <div class=\"d-flex align-items-center\">\n      <img\n        :src=\"item.user.image.thumb.url\"\n        :alt=\"item.user.name\"\n        width=\"24\"\n        height=\"24\"\n        class=\"rounded-circle\"\n      >\n      <router-link\n        :to=\"`/u/${ item.user.slug }`\"\n        class=\"mx-2 text-capitalize text-body\"\n        style=\"font-size: 90%\"\n      >{{ item.user.name }}</router-link>\n      <small class=\"text-muted\">{{ timeAgo(item.timestamp) }}</small>\n    </div>\n    <div v-if=\"edit\">\n      <comment-form\n        :item=\"item\"\n        :actionAttr=\"editActionAttr()\"\n        :text=\"item.content\"\n        v-on:commentEditResponse=\"commentEditResponse\"\n        v-on:commentDrop=\"commentDrop\"\n      />\n    </div>\n    <div v-else class=\"mt-2 bg-light rounded p-3\">\n      <vue-markdown :source=\"item.content\" class=\"text-break\" />\n    </div>\n    <div v-if=\"isAuthenticated\" class=\"mt-2 d-flex align-items-center\">\n      <comment-like :item=\"item\" :type=\"type\" />\n      <div v-if=\"item.user.id === currentUser.id\" v-on:click=\"commentEdit\" class=\"d-flex text-muted mx-2 mouse-pointer\">\n        <span class=\"material-icons md-16\">edit</span>\n      </div>\n      <div v-if=\"item.user.id === currentUser.id\" v-on:click=\"commentDestroy\" class=\"d-flex text-muted mx-2 mouse-pointer\">\n        <span class=\"material-icons md-16\">delete</span>\n      </div>\n      <div v-on:click=\"commentReply\" class=\"d-flex text-muted mx-2 mouse-pointer\">\n        <span class=\"material-icons md-16\">reply</span>\n      </div>\n    </div>\n    <div v-if=\"reply\">\n      <comment-form\n        :item=\"item\"\n        :actionAttr=\"'REPLY_NEW'\"\n        :text=\"null\"\n        v-on:commentReplyNew=\"commentReplyNew\"\n        v-on:commentDrop=\"commentDrop\"\n      />\n    </div>\n  </div>\n</template>\n\n<script>\nimport VueMarkdown from 'vue-markdown'\nimport { mapGetters } from 'vuex'\nimport { isMobile } from 'mobile-device-detect'\n// import CommentForm from './Form.vue'\n// import CommentLike from '../buttons/CommentLike.vue'\nconst CommentForm = () => import('./Form.vue')\nconst CommentLike = () => import('../buttons/CommentLike.vue')\n\nexport default {\n  name: 'Comment',\n  props: ['item', 'type', 'lastCommentId'],\n  data () {\n    return {\n      edit: false,\n      reply: false,\n    }\n  },\n  components: {\n    CommentForm,\n    CommentLike,\n    VueMarkdown,\n  },\n  computed: {\n    ...mapGetters(['isAuthenticated', 'currentUser', 'navbarHeight']),\n    mobile () {\n      return isMobile\n    },\n  },\n  methods: {\n    editActionAttr () {\n      if (this.item.commentId) return 'REPLY_EDIT'\n      else return 'COMMENT_EDIT'\n    },\n    commentReply () {\n      console.log('reply')\n      this.reply = true\n    },\n    commentEdit () {\n      this.edit = true\n    },\n    commentDrop () {\n      this.edit = false\n      this.reply = false\n      return false\n    },\n    commentReplyNew (payload) {\n      console.log(payload)\n      this.$emit('commentReplyNew', payload)\n      this.reply = false\n      // this.item.content = value.data.content\n    },\n    commentEditResponse (payload) {\n      this.edit = false\n      if (this.item.commentId) {\n        console.log(payload)\n        console.log(this.item)\n        // reply id : this.item.id\n        // reply content : this.item.content\n        // reply comment : this.item.commentId\n        const reply = payload.data.replies.filter(r => r.id === this.item.id)[0]\n        this.item.content = reply.content\n      }\n      else {\n        this.item.content = payload.data.content\n      }\n    },\n    commentDestroy () {\n      let actionAttr = ''\n      let payload = {}\n      if (this.type === 'comment') {\n        // console.log(`delete comment ${ this.item.id }`)\n        payload = {\n          comment_id: this.item.id,\n          recipe_id: this.item.recipe.id,\n          type: this.type,\n        }\n        actionAttr = 'COMMENT_DELETE'\n      }\n      if (this.type === 'reply') {\n        // console.log(`delete comment ${ this.item.id }`)\n        payload = {\n          comment_id: this.item.commentId,\n          recipe_id: this.item.recipeId,\n          id: this.item.id,\n          type: this.type,\n        }\n        actionAttr = 'REPLY_DELETE'\n      }\n      this.$store\n        .dispatch(actionAttr, payload)\n        .then( response => {\n          console.log(response)\n          if (response.status === 204) {\n            this.$emit('commentDestroyed', payload)\n          }\n        })\n    },\n    timeAgo (time) {\n      const between = Math.trunc((new Date().getTime() - time) / 1000)\n      if (between < 3600) {\n        return this.$tc('comment.minutes', Math.trunc(between / 60))\n      } else if (between < 86400) {\n        return this.$tc('comment.hours', Math.trunc(between / 3600))\n      } else if (between < 2592000) {\n        return this.$tc('comment.days', Math.trunc(between / 86400))\n      } else if (between < 31104000) {\n        return this.$tc('comment.months', Math.trunc(between / 2592000))\n      } else {\n        return this.$tc('comment.years', Math.trunc(between / 311004000))\n      }\n    },\n    scroll2Anchor () {\n      // const currentPage = this.$route.fullpath\n      const target = this.$route.hash\n      if(target) {\n        console.log(this.$refs)\n        console.log(this.$route)\n        console.log(target)\n        console.log(target.match(/(?:#)(.+)/)[1])\n        let element = this.$refs[target.match(/(?:#)(.+)/)[1]]\n        // let element = this.$el.querySelector(target)\n        // let element = this.$el\n        // if (target.match(/(?:#)(.+)/)[1] === 'comments') element = this.$refs.comments\n        console.log(element)\n        if (element) {\n          const scrollOptions = {\n            top: element.offsetTop - this.navbarHeight,\n            left: 0,\n            behavior: 'smooth'\n          };\n          window.scrollTo(scrollOptions)\n          window.history.pushState(\"object or string\", \"Title\", this.$route.path)\n        }\n      }\n    },\n  },\n  mounted () {\n    console.log(`${this.type} ${this.item.id}`)\n    if (this.$route.hash && this.item.id === parseInt(this.$route.hash.match(/(?:#comment)(.+)/)[1])) this.scroll2Anchor()\n    // if (this.type === 'comment' && this.item.id === this.lastCommentId) {\n    //   console.log('all comments mounted')\n    //   console.log(this.$route)\n    //   this.$emit('lastCommentMounted', true)\n    // }\n  }\n}\n</script>\n","var render = function() {\n  var _vm = this\n  var _h = _vm.$createElement\n  var _c = _vm._self._c || _h\n  return _c(\n    \"div\",\n    {\n      ref: _vm.type + _vm.item.id,\n      staticClass: \"mt-3 mb-2\",\n      attrs: { id: \"comment\" + _vm.item.id }\n    },\n    [\n      _c(\n        \"div\",\n        { staticClass: \"d-flex align-items-center\" },\n        [\n          _c(\"img\", {\n            staticClass: \"rounded-circle\",\n            attrs: {\n              src: _vm.item.user.image.thumb.url,\n              alt: _vm.item.user.name,\n              width: \"24\",\n              height: \"24\"\n            }\n          }),\n          _vm._v(\" \"),\n          _c(\n            \"router-link\",\n            {\n              staticClass: \"mx-2 text-capitalize text-body\",\n              staticStyle: { \"font-size\": \"90%\" },\n              attrs: { to: \"/u/\" + _vm.item.user.slug }\n            },\n            [_vm._v(_vm._s(_vm.item.user.name))]\n          ),\n          _vm._v(\" \"),\n          _c(\"small\", { staticClass: \"text-muted\" }, [\n            _vm._v(_vm._s(_vm.timeAgo(_vm.item.timestamp)))\n          ])\n        ],\n        1\n      ),\n      _vm._v(\" \"),\n      _vm.edit\n        ? _c(\n            \"div\",\n            [\n              _c(\"comment-form\", {\n                attrs: {\n                  item: _vm.item,\n                  actionAttr: _vm.editActionAttr(),\n                  text: _vm.item.content\n                },\n                on: {\n                  commentEditResponse: _vm.commentEditResponse,\n                  commentDrop: _vm.commentDrop\n                }\n              })\n            ],\n            1\n          )\n        : _c(\n            \"div\",\n            { staticClass: \"mt-2 bg-light rounded p-3\" },\n            [\n              _c(\"vue-markdown\", {\n                staticClass: \"text-break\",\n                attrs: { source: _vm.item.content }\n              })\n            ],\n            1\n          ),\n      _vm._v(\" \"),\n      _vm.isAuthenticated\n        ? _c(\n            \"div\",\n            { staticClass: \"mt-2 d-flex align-items-center\" },\n            [\n              _c(\"comment-like\", { attrs: { item: _vm.item, type: _vm.type } }),\n              _vm._v(\" \"),\n              _vm.item.user.id === _vm.currentUser.id\n                ? _c(\n                    \"div\",\n                    {\n                      staticClass: \"d-flex text-muted mx-2 mouse-pointer\",\n                      on: { click: _vm.commentEdit }\n                    },\n                    [\n                      _c(\"span\", { staticClass: \"material-icons md-16\" }, [\n                        _vm._v(\"edit\")\n                      ])\n                    ]\n                  )\n                : _vm._e(),\n              _vm._v(\" \"),\n              _vm.item.user.id === _vm.currentUser.id\n                ? _c(\n                    \"div\",\n                    {\n                      staticClass: \"d-flex text-muted mx-2 mouse-pointer\",\n                      on: { click: _vm.commentDestroy }\n                    },\n                    [\n                      _c(\"span\", { staticClass: \"material-icons md-16\" }, [\n                        _vm._v(\"delete\")\n                      ])\n                    ]\n                  )\n                : _vm._e(),\n              _vm._v(\" \"),\n              _c(\n                \"div\",\n                {\n                  staticClass: \"d-flex text-muted mx-2 mouse-pointer\",\n                  on: { click: _vm.commentReply }\n                },\n                [\n                  _c(\"span\", { staticClass: \"material-icons md-16\" }, [\n                    _vm._v(\"reply\")\n                  ])\n                ]\n              )\n            ],\n            1\n          )\n        : _vm._e(),\n      _vm._v(\" \"),\n      _vm.reply\n        ? _c(\n            \"div\",\n            [\n              _c(\"comment-form\", {\n                attrs: { item: _vm.item, actionAttr: \"REPLY_NEW\", text: null },\n                on: {\n                  commentReplyNew: _vm.commentReplyNew,\n                  commentDrop: _vm.commentDrop\n                }\n              })\n            ],\n            1\n          )\n        : _vm._e()\n    ]\n  )\n}\nvar staticRenderFns = []\nrender._withStripped = true\n\nexport { render, staticRenderFns }"],"mappings":";;;;;;;;;;AAAA;AAAA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA,uBAiBA;AACA;AACA;;;;;;;;;;;;ACtCA;AAAA;AAAA;;;;;;;;;;;;ACAA;AAAA;AAAA;AAAA;AAAA;AAAA;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;ACsDA;AACA;AACA;AAEA;AACA;AAAA;AAAA;AAAA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAFA;AAIA;AACA;AACA;AACA;AACA;AAHA;AAKA;AAEA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AAAA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAEA;AACA;AACA;AAAA;AAAA;AAAA;AACA;AACA;AAEA;AACA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AAJA;AAMA;AACA;AACA;AAAA;AAGA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AAAA;AACA;AACA;AACA;AACA;AACA;AAEA;AACA;AACA;AAAA;AACA;AAAA;AACA;AACA;AACA;AACA;AAHA;AAKA;AACA;AACA;AACA;AACA;AA1GA;AA4GA;AACA;AACA;AAEA;AACA;AACA;AACA;AACA;AAxIA;;;;;;;;;;;;AC9DA;AAAA;AAAA;AAAA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;AACA;;;;;A","sourceRoot":""}