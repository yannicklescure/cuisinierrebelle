<div id="reply-<%= reply.id %>" class="mt-3 pl-3 reply" data-reply="<%= reply.id %>" data-comment="<%= reply.comment.id %>">
  <div class="d-flex align-items-center small">
    <img src="<%= reply.user.image.thumb.url %>" width="24px" height="24px" class="rounded-circle mr-2" style="object-fit: cover;">
    <strong><%= link_to reply.user.name, user_path(reply.user), class: 'text-body' %></strong>&ensp;
    <% time_since_creation = TimeDifference.between(reply.created_at, Time.current) %>
    <% if time_since_creation.in_years.floor >= 2 %>
      <%= t(".years_ago", count: time_since_creation.in_years.floor) %>
    <% elsif time_since_creation.in_years.floor < 1 && time_since_creation.in_months.floor.positive? %>
      <%= t(".months_ago", count: time_since_creation.in_months.floor) %>
    <% elsif time_since_creation.in_months.floor < 1 && time_since_creation.in_weeks.floor.positive? %>
      <%= t(".weeks_ago", count: time_since_creation.in_weeks.floor) %>
    <% elsif time_since_creation.in_weeks.floor.floor < 1 && time_since_creation.in_days.floor.positive? %>
      <%= t(".days_ago", count: time_since_creation.in_days.floor) %>
    <% elsif time_since_creation.in_days.floor < 1 && time_since_creation.in_hours.floor.positive? %>
      <%= t(".hours_ago", count: time_since_creation.in_hours.floor) %>
    <% elsif time_since_creation.in_hours.floor < 1 && time_since_creation.in_minutes.floor.positive? %>
      <%= t(".minutes_ago", count: time_since_creation.in_minutes.floor) %>
    <% elsif time_since_creation.in_minutes.floor < 1 && time_since_creation.in_seconds.floor.positive? %>
      <%= t(".seconds_ago", count: time_since_creation.in_seconds.floor) %>
    <% else %>
      <%= t(".seconds_ago", count: 1) %>
    <% end %><%= "&nbsp;#{t('.edited')}".html_safe if reply.created_at != reply.updated_at && !client.device_type.nil? && client.device_type.match(/desktop/) %>&ensp;
    <% if reply.user == current_user %>
    <a href="" id="edit-reply-<%= reply.id %>" class="text-decoration-none mr-2"><%= t('.edit_html') %></a>
    <% end %>
    <% if reply.user == current_user || recipe.user == current_user || !current_user.nil? && current_user.admin %>
    <%= link_to t('.destroy_html'), recipe_comment_reply_path(recipe, comment, reply), data: { confirm: t(".are_you_sure") }, method: :delete, remote: true, class: 'text-decoration-none mr-2' %>
    <% end %>
    <div class="d-flex">
      <% if user_signed_in? %>
        <%= link_to t('.recipe_comment_reply_likes_html'), recipe_comment_reply_likes_path(recipe, reply.comment, reply), method: :patch, remote: true, class: 'text-decoration-none mr-1' %>
      <% else %>
        <%= link_to t('.recipe_comment_reply_likes_html'), new_user_session_path, class: 'text-decoration-none mr-1' %>
      <% end %>
      <div id="<%= "reply-#{reply.id}-likes" %>">
        <%= reply.reply_likes.count %>
      </div>
    </div>
    <% if reply.reply_likes.find_by(user: recipe.user) %>
      <div id="<%= "user-recipe-like-#{reply.id}" %>" class="like ml-2" style="background-image: url(<%= recipe.user.image.thumb.url %>);">
        <i class="material-icons text-danger like-heart" style="font-size: 12px;">favorite</i>
      </div>
    <% end %>
  </div>
  <% if reply.user == current_user %>
  <div id="edit-reply-<%= reply.id %>-form" class="d-none my-3">
    <% reply.content = reply.content.gsub(/\[(http.*)\)$/) { |e| e.match(/\((http.*)\)$/)[1] } %>
    <%= render "replies/form", recipe: reply.comment.recipe, comment: comment, reply: reply %>
  </div>
  <% end %>
  <div id="reply-<%= reply.id %>-content" class="reply-content" data-reply="<%= reply.id %>">
    <% renderer = Redcarpet::Render::HTML.new(hard_wrap: true, link_attributes: { target: '_blank' }) %>
    <% extensions = {autolink: true} %>
    <% markdown = Redcarpet::Markdown.new(renderer, extensions) %>
    <div class="my-1 bg-light rounded p-3"><%= markdown.render(reply.content).html_safe %></div>
    <% if !reply.photo.url.nil? %>
    <div class="my-1 p-3">
      <button type="button" class="border-0 m-0 p-0" data-toggle="modal" data-target=".reply-photo-active-<%= reply.id %>">
        <div class="reply-photo-preview rounded" style="background-image: url('<%= reply.photo.url(:preview) %>')"></div>
        <%#= image_tag reply.photo.url(:thumb), id: "reply-photo-active-#{reply.id}", height: 64, class: 'img-fluid rounded' %>
      </button>
      <div class="modal fade reply-photo-active-<%= reply.id %>" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
        <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
          <div class="modal-content border-0">
            <div class="d-flex justify-content-end align-items-start position-relative">
              <%= image_tag reply.photo.url(:full), id: "reply-photo-active-#{reply.id}", class: 'img-fluid rounded' %>
              <!-- https://github.com/sdsykes/fastimage -->
              <%# image = image_url reply.photo.url(:full) %>
              <%# FastImage.size(image) %>
              <button type="button" class="close p-3 position-absolute btn" data-dismiss="modal" aria-label="Close">
                <span aria-hidden="true">&times;</span>
              </button>
            </div>
          </div>
        </div>
      </div>
    </div>
    <% end %>
  </div>
</div>
