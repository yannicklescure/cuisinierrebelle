function refreshForm(innerHTML) {
  const newReplyForm = document.getElementById('reply-reply-form-<%= @reply.comment.id %>');
  newReplyForm.innerHTML = innerHTML;
}

function addComment(replyHTML) {
  const replies = document.getElementById('replies-list');
  replies.insertAdjacentHTML('afterbegin', replyHTML);
}

<% if @reply.errors.any? %>
  refreshForm('<%= j render "replies/form", recipe: @recipe, comment: @comment, reply: @reply %>');
<% else %>
  document.querySelector(`#edit-reply-${<%= @reply.id %>}-form`).classList.add('d-none');
  reply = document.querySelector(`#reply-${<%= @reply.id %>}-content`);
  <% renderer = Redcarpet::Render::HTML.new(hard_wrap: true, link_attributes: { target: '_blank' }) %>
  <% extensions = {autolink: true} %>
  <% markdown = Redcarpet::Markdown.new(renderer, extensions) %>
  replyContent = `<div class="my-1 bg-light rounded p-3"><%= markdown.render(@reply.content).html_safe %></div>`;
  replyContent += `<% if !@reply.photo.url.nil? %>
      <div class="my-1 p-3">
        <button type="button" class="border-0 m-0 p-0" data-bs-toggle="modal" data-target=".reply-photo-active-<%= @reply.id %>">
          <div class="reply-photo-preview rounded" style="background-image: url('<%= @reply.photo.url(:preview) %>')"></div>
          <%#= image_tag @reply.photo.url(:thumb), id: "reply-photo-active-#{@reply.id}", height: 64, class: 'img-fluid rounded' %>
        </button>
        <div class="modal fade reply-photo-active-<%= @reply.id %>" tabindex="-1" role="dialog" aria-labelledby="myLargeModalLabel" aria-hidden="true">
          <div class="modal-dialog modal-lg modal-dialog-centered" role="document">
            <div class="modal-content border-0">
              <div class="d-flex justify-content-end align-items-start position-relative">
                <%= image_tag @reply.photo.url(:full), id: "reply-photo-active-#{@reply.id}", class: 'img-fluid rounded' %>
                <!-- https://github.com/sdsykes/fastimage -->
                <%# image = image_url @reply.photo.url(:full) %>
                <%# FastImage.size(image) %>
                <button type="button" class="close p-3 position-absolute btn" data-dismiss="modal" aria-label="Close">
                  <span aria-hidden="true">&times;</span>
                </button>
              </div>
            </div>
          </div>
        </div>
      </div>
      <% end %>`;
  reply.innerHTML = replyContent;
  reply.classList.remove('d-none');
  // replies = document.querySelectorAll('.reply-content');
  // replies.forEach(reply => {
  //   const editReplyId = document.querySelector(`#edit-reply-${reply.dataset.reply}`);
  //   if (editReplyId) {
  //     editReplyId.addEventListener('click', (event) => {
  //       event.preventDefault();
  //       document.querySelector(`#reply-${reply.dataset.reply}-content`).classList.add('d-none');
  //       document.querySelector(`#edit-reply-${reply.dataset.reply}-form`).classList.remove('d-none');
        // spinner = document.querySelector(`.spinner-reply-<%= @reply.comment.id %>`);
        spinner = document.querySelector(`.spinner-reply-<%= @reply.id %>`);
        if (spinner) {
          spinner.parentNode.removeChild(spinner);
        //   spinner.parentElement.insertAdjacentHTML('beforeEnd', `<input type="submit" name="commit" value="Reply" class="btn btn btn-light" data-disable-with="Reply" />`);
        //   spinner.remove();
        }
  //     });
  //   }
  // });
  commentsCount = document.querySelector('#comments-count');
  <% count = 0 %>
  <% count = @recipe.comments.map { |comment| comment.replies.count }.sum %>
  <% count += @recipe.comments.count %>
  commentsCount.innerHTML = `<%= t('.comments', count: count) %>`;
<% end %>


