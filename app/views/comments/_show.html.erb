<div id="comment-<%= comment.id %>" class="mt-3" data-comment="<%= comment.id %>">
  <div class="d-flex small">
    <strong><%= link_to comment.user.name, user_path(comment.user), class: 'text-body' %></strong>&ensp;
    <% time_since_creation = TimeDifference.between(comment.created_at, Time.current) %>
    <% if time_since_creation.in_years.floor >= 2 %>
      <%= t(".years_ago", count: time_since_creation.in_years.floor) %>
    <% elsif time_since_creation.in_years.floor < 1 && time_since_creation.in_months.floor.positive? %>
      <%= t(".months_ago", count: time_since_creation.in_months.floor) %>
    <% elsif time_since_creation.in_months.floor < 1 && time_since_creation.in_weeks.floor.positive? %>
      <%= t(".weeks_ago", count: time_since_creation.in_weeks.floor) %>
    <% elsif time_since_creation.in_weeks.floor.floor < 1 && time_since_creation.in_days.floor.positive? %>
      <%= t(".days_ago", count: time_since_creation.in_days.floor) %>
    <% elsif time_since_creation.in_days.floor < 1 && time_since_creation.in_hours.floor.positive? %>
      <%= t(".hours_ago", count: time_since_creation.in_hours.floor) %>
    <% elsif time_since_creation.in_hours.floor < 1 && time_since_creation.in_minutes.floor.positive? %>
      <%= t(".minutes_ago", count: time_since_creation.in_minutes.floor) %>
    <% elsif time_since_creation.in_minutes.floor < 1 && time_since_creation.in_seconds.floor.positive? %>
      <%= t(".seconds_ago", count: time_since_creation.in_seconds.floor) %>
    <% else %>
      <%= t(".seconds_ago", count: 1) %>
    <% end %>&ensp;
    <% if comment.user == current_user || recipe.user == current_user %>
    <%= link_to t('.delete_html'), recipe_comment_path(recipe, comment), data: { confirm: t(".are_you_sure") }, method: :delete, remote: true %>
    <% end %>
  </div>
  <% renderer = Redcarpet::Render::HTML.new(hard_wrap: true, link_attributes: { target: '_blank' }) %>
  <% extensions = {autolink: true} %>
  <% markdown = Redcarpet::Markdown.new(renderer, extensions) %>
  <div class="my-1"><%= markdown.render(comment.content).html_safe %></div>
  <% if comment.replies.where(spam: false).any? %>
  <div id="comment-<%= comment.id %>-replies">
    <div id="comment-<%= comment.id %>-replies-list-btn" class="text-muted btn btn-sm p-0 reply" data-comment="<%= comment.id %>">
      <span id="replies-list-arrow-<%= comment.id %>"><i class="fas fa-sort-down"></i></span>&ensp;<%= t('.replies', count: comment.replies.where(spam: false).count) %>
    </div>
    <div id="replies-list-<%= comment.id %>" class="d-none" data-comment="<%= comment.id %>">
      <div id="replies-list-box-<%= comment.id %>" class="d-flex flex-column">
        <% comment.replies.sort_by { |date| date.created_at }.each do |reply| %>
          <%= render "replies/show", recipe: recipe, comment: comment, reply: reply if !reply.spam %>
        <% end %>
      </div>
      <% if user_signed_in? %>
      <div class="text-muted btn btn-sm p-0 reply-reply" data-comment="<%= comment.id %>"><%= t('.reply') %></div>
      <div id="reply-reply-form-<%= comment.id %>" class="my-3 d-none">
        <%= render 'replies/form', recipe: recipe, comment: comment, reply: Reply.new %>
      </div>
      <% else %>
        <%= link_to t('.reply'), new_user_session_path, class: "text-muted btn btn-sm p-0" %>
      <% end %>
    </div>
  </div>
  <% else %>
  <div id="comment-<%= comment.id %>-replies">
    <div id="replies-list-<%= comment.id %>" data-comment="<%= comment.id %>">
      <% if user_signed_in? %>
      <div id="replies-list-box-<%= comment.id %>"></div>
      <div class="text-muted btn btn-sm p-0 no-reply" data-comment="<%= comment.id %>"><%= t('.reply') %></div>
      <div id="reply-form-<%= comment.id %>" class="my-3 d-none">
        <%= render 'replies/form', recipe: recipe, comment: comment, reply: Reply.new %>
      </div>
      <% else %>
        <%= link_to t('.reply'), new_user_session_path, class: "text-muted btn btn-sm p-0" %>
      <% end %>
    </div>
  </div>
  <% end %>
</div>
